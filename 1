--// Stable Skin Copier
-- Рабочий локальный копировщик доступного контента

local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

-- Удаляем старый GUI
if game.CoreGui:FindFirstChild("SkinGui") then
    game.CoreGui.SkinGui:Destroy()
end

-- GUI
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "SkinGui"
ScreenGui.Parent = game.CoreGui

local Frame = Instance.new("Frame")
Frame.Size = UDim2.new(0, 260, 0, 180)
Frame.Position = UDim2.new(0.5, -130, 0.4, 0)
Frame.BackgroundColor3 = Color3.fromRGB(30,30,30)
Frame.Active = true
Frame.Draggable = true
Frame.Parent = ScreenGui

local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(0, 6)
UICorner.Parent = Frame

local TextBox = Instance.new("TextBox")
TextBox.Size = UDim2.new(0, 230, 0, 36)
TextBox.Position = UDim2.new(0, 15, 0, 12)
TextBox.PlaceholderText = "Ник игрока или часть ника"
TextBox.Text = ""
TextBox.TextScaled = true
TextBox.BackgroundColor3 = Color3.fromRGB(50,50,50)
TextBox.TextColor3 = Color3.fromRGB(255,255,255)
TextBox.Parent = Frame

local UICorner2 = Instance.new("UICorner")
UICorner2.CornerRadius = UDim.new(0, 4)
UICorner2.Parent = TextBox

local Button = Instance.new("TextButton")
Button.Size = UDim2.new(0, 230, 0, 44)
Button.Position = UDim2.new(0, 15, 0, 60)
Button.Text = "Сменить внешность"
Button.TextScaled = true
Button.BackgroundColor3 = Color3.fromRGB(70,70,70)
Button.TextColor3 = Color3.fromRGB(255,255,255)
Button.Parent = Frame

local UICorner3 = Instance.new("UICorner")
UICorner3.CornerRadius = UDim.new(0, 4)
UICorner3.Parent = Button

local AnimButton = Instance.new("TextButton")
AnimButton.Size = UDim2.new(0, 230, 0, 30)
AnimButton.Position = UDim2.new(0, 15, 0, 112)
AnimButton.Text = "Копировать анимации"
AnimButton.TextScaled = true
AnimButton.BackgroundColor3 = Color3.fromRGB(60,60,60)
AnimButton.TextColor3 = Color3.fromRGB(255,255,255)
AnimButton.Parent = Frame

local UICorner4 = Instance.new("UICorner")
UICorner4.CornerRadius = UDim.new(0, 4)
UICorner4.Parent = AnimButton

local StatusLabel = Instance.new("TextLabel")
StatusLabel.Size = UDim2.new(0, 230, 0, 20)
StatusLabel.Position = UDim2.new(0, 15, 0, 150)
StatusLabel.Text = "Готово"
StatusLabel.TextScaled = true
StatusLabel.BackgroundTransparency = 1
StatusLabel.TextColor3 = Color3.fromRGB(200,200,200)
StatusLabel.Parent = Frame

-- Функция для поиска игрока по части ника
local function findPlayerByPartialName(partialName)
    if partialName == "" then return nil end
    
    partialName = partialName:lower()
    local players = Players:GetPlayers()
    
    -- Сначала ищем точное совпадение
    for _, player in ipairs(players) do
        if player.Name:lower() == partialName or player.DisplayName:lower() == partialName then
            return player
        end
    end
    
    -- Затем ищем частичное совпадение
    for _, player in ipairs(players) do
        if player.Name:lower():find(partialName, 1, true) or 
           player.DisplayName:lower():find(partialName, 1, true) then
            return player
        end
    end
    
    return nil
end

-- Оптимизированная функция для точного копирования положения аксессуара
local function copyAccessoryPosition(originalAccessory, clonedAccessory, targetChar, myChar)
    local originalHandle = originalAccessory:FindFirstChild("Handle")
    local clonedHandle = clonedAccessory:FindFirstChild("Handle")
    local originalHead = targetChar:FindFirstChild("Head")
    local myHead = myChar:FindFirstChild("Head")
    
    if not originalHandle or not clonedHandle or not originalHead or not myHead then
        return
    end
    
    -- Находим оригинальный weld (крепление)
    local originalWeld
    for _, child in ipairs(originalHandle:GetChildren()) do
        if child:IsA("Weld") or child:IsA("Motor6D") then
            if child.Part0 == originalHead then
                originalWeld = child
                break
            end
        end
    end
    
    -- Очищаем старые крепления у клона
    for _, weld in ipairs(clonedHandle:GetChildren()) do
        if weld:IsA("Weld") or weld:IsA("Motor6D") then
            weld:Destroy()
        end
    end
    
    if originalWeld then
        -- Точное копирование оригинального крепления
        local newWeld = originalWeld:Clone()
        newWeld.Part0 = myHead
        newWeld.Part1 = clonedHandle
        newWeld.Parent = clonedHandle
    else
        -- Если нет weld, создаем его на основе относительного положения
        local relativeCFrame = originalHead.CFrame:ToObjectSpace(originalHandle.CFrame)
        
        local weld = Instance.new("Weld")
        weld.Name = "HeadWeld"
        weld.Part0 = myHead
        weld.Part1 = clonedHandle
        weld.C0 = relativeCFrame
        weld.Parent = clonedHandle
    end
end

-- Оптимизированная функция для копирования цвета тела
local function copyBodyColor(targetChar, myChar)
    local bodyParts = {"Head", "Torso", "LeftArm", "RightArm", "LeftLeg", "RightLeg"}
    
    for _, partName in ipairs(bodyParts) do
        local targetPart = targetChar:FindFirstChild(partName)
        local myPart = myChar:FindFirstChild(partName)
        
        if targetPart and myPart then
            myPart.BrickColor = targetPart.BrickColor
            myPart.Material = targetPart.Material
            myPart.Transparency = targetPart.Transparency
        end
    end
end

-- Оптимизированная функция для копирования головы
local function copyHead(targetChar, myChar)
    local targetHead = targetChar:FindFirstChild("Head")
    local myHead = myChar:FindFirstChild("Head")
    
    if not targetHead or not myHead then return end
    
    -- Копируем меш головы
    local targetMesh = targetHead:FindFirstChildOfClass("SpecialMesh")
    if targetMesh then
        for _, mesh in ipairs(myHead:GetChildren()) do
            if mesh:IsA("SpecialMesh") then
                mesh:Destroy()
            end
        end
        targetMesh:Clone().Parent = myHead
    end
    
    -- Копируем лицо
    local face = targetHead:FindFirstChildOfClass("Decal")
    if face then
        for _, decal in ipairs(myHead:GetChildren()) do
            if decal:IsA("Decal") then
                decal:Destroy()
            end
        end
        face:Clone().Parent = myHead
    end
end

-- Оптимизированная функция для копирования одежды
local function copyClothing(targetChar, myChar)
    for _, item in ipairs(myChar:GetChildren()) do
        if item:IsA("Shirt") or item:IsA("Pants") or item:IsA("ShirtGraphic") then
            item:Destroy()
        end
    end
    
    for _, item in ipairs(targetChar:GetChildren()) do
        if item:IsA("Shirt") or item:IsA("Pants") or item:IsA("ShirtGraphic") then
            item:Clone().Parent = myChar
        end
    end
end

-- Оптимизированная функция для копирования аксессуаров
local function copyAccessories(targetChar, myChar)
    for _, item in ipairs(myChar:GetChildren()) do
        if item:IsA("Accessory") or item:IsA("Hat") then
            item:Destroy()
        end
    end
    
    for _, originalAccessory in ipairs(targetChar:GetChildren()) do
        if (originalAccessory:IsA("Accessory") or originalAccessory:IsA("Hat")) and originalAccessory:FindFirstChild("Handle") then
            local clone = originalAccessory:Clone()
            clone.Parent = myChar
            copyAccessoryPosition(originalAccessory, clone, targetChar, myChar)
        end
    end
end

-- Оптимизированная функция для копирования частей тела
local function copyBodyParts(targetChar, myChar)
    local bodyParts = {"LeftArm", "RightArm", "LeftLeg", "RightLeg", "Torso"}
    
    for _, partName in ipairs(bodyParts) do
        local targetPart = targetChar:FindFirstChild(partName)
        local myPart = myChar:FindFirstChild(partName)
        
        if targetPart and myPart then
            myPart.Size = targetPart.Size
        end
    end
end

-- Оптимизированная функция для копирования анимаций
local function copyRobloxAnimations(targetChar, myChar)
    local targetHumanoid = targetChar:FindFirstChildOfClass("Humanoid")
    local myHumanoid = myChar:FindFirstChildOfClass("Humanoid")
    
    if not targetHumanoid or not myHumanoid then return false end
    
    -- Ищем скрипт Animate
    local targetAnimate = targetChar:FindFirstChild("Animate")
    if targetAnimate then
        local myAnimate = myChar:FindFirstChild("Animate")
        if myAnimate then
            myAnimate:Destroy()
        end
        
        targetAnimate:Clone().Parent = myChar
        return true
    end
    
    return false
end

-- Основная функция смены внешности с оптимизацией
local function ChangeAppearance(targetPlayer)
    if not targetPlayer or not targetPlayer.Character or not LocalPlayer.Character then 
        return false 
    end

    local char = LocalPlayer.Character
    local targetChar = targetPlayer.Character
    
    -- Ждем загрузку персонажей
    if not char:FindFirstChild("Head") or not targetChar:FindFirstChild("Head") then
        return false
    end

    -- Выполняем копирование с защитой от ошибок
    local success = pcall(function()
        copyBodyColor(targetChar, char)
        copyBodyParts(targetChar, char)
        copyHead(targetChar, char)
        copyClothing(targetChar, char)
        copyAccessories(targetChar, char)
        
        local targetHumanoid = targetChar:FindFirstChildOfClass("Humanoid")
        local myHumanoid = char:FindFirstChildOfClass("Humanoid")
        
        if targetHumanoid and myHumanoid then
            myHumanoid.BodyTypeScale = targetHumanoid.BodyTypeScale
            myHumanoid.HeadScale = targetHumanoid.HeadScale
        end
    end)
    
    return success
end

-- Обновление статуса
local function updateStatus(text, color)
    StatusLabel.Text = text
    StatusLabel.TextColor3 = color or Color3.fromRGB(200,200,200)
end

-- Кнопка смены внешности
Button.MouseButton1Click:Connect(function()
    local name = TextBox.Text
    local target = findPlayerByPartialName(name)
    
    if target then
        updateStatus("Копируем внешность...", Color3.fromRGB(255,255,0))
        local success = ChangeAppearance(target)
        
        if success then
            updateStatus("Внешность скопирована!", Color3.fromRGB(0,255,0))
            Button.Text = "Готово!"
        else
            updateStatus("Ошибка копирования!", Color3.fromRGB(255,0,0))
            Button.Text = "Ошибка!"
        end
    else
        updateStatus("Игрок не найден!", Color3.fromRGB(255,0,0))
        Button.Text = "Не найден!"
    end
    
    task.wait(2)
    Button.Text = "Сменить внешность"
    updateStatus("Готово")
end)

-- Кнопка копирования анимаций
AnimButton.MouseButton1Click:Connect(function()
    local name = TextBox.Text
    local target = findPlayerByPartialName(name)
    
    if target and target.Character and LocalPlayer.Character then
        updateStatus("Копируем анимации...", Color3.fromRGB(255,255,0))
        local success = copyRobloxAnimations(target.Character, LocalPlayer.Character)
        
        if success then
            updateStatus("Анимации скопированы!", Color3.fromRGB(0,255,0))
            AnimButton.Text = "Готово!"
        else
            updateStatus("Анимации не найдены!", Color3.fromRGB(255,165,0))
            AnimButton.Text = "Не найдены!"
        end
    else
        updateStatus("Игрок не найден!", Color3.fromRGB(255,0,0))
        AnimButton.Text = "Ошибка!"
    end
    
    task.wait(2)
    AnimButton.Text = "Копировать анимации"
    updateStatus("Готово")
end)

-- Автозаполнение при фокусе
TextBox.Focused:Connect(function()
    TextBox.Text = ""
end)

TextBox.FocusLost:Connect(function()
    if TextBox.Text == "" then
        TextBox.Text = "Введите ник игрока"
    end
end)

updateStatus("Готово к работе")
