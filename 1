--// Stable Skin Copier
-- Рабочий локальный копировщик доступного контента

local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

-- Удаляем старый GUI
if game.CoreGui:FindFirstChild("SkinGui") then
    game.CoreGui.SkinGui:Destroy()
end

-- GUI
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "SkinGui"
ScreenGui.Parent = game.CoreGui

local Frame = Instance.new("Frame")
Frame.Size = UDim2.new(0, 260, 0, 160)
Frame.Position = UDim2.new(0.5, -130, 0.4, 0)
Frame.BackgroundColor3 = Color3.fromRGB(30,30,30)
Frame.Active = true
Frame.Draggable = true
Frame.Parent = ScreenGui

local TextBox = Instance.new("TextBox")
TextBox.Size = UDim2.new(0, 230, 0, 36)
TextBox.Position = UDim2.new(0, 15, 0, 12)
TextBox.PlaceholderText = "Ник игрока"
TextBox.Text = ""
TextBox.TextScaled = true
TextBox.BackgroundColor3 = Color3.fromRGB(50,50,50)
TextBox.TextColor3 = Color3.fromRGB(255,255,255)
TextBox.Parent = Frame

local Button = Instance.new("TextButton")
Button.Size = UDim2.new(0, 230, 0, 44)
Button.Position = UDim2.new(0, 15, 0, 66)
Button.Text = "Сменить внешность"
Button.TextScaled = true
Button.BackgroundColor3 = Color3.fromRGB(70,70,70)
Button.TextColor3 = Color3.fromRGB(255,255,255)
Button.Parent = Frame

local AnimButton = Instance.new("TextButton")
AnimButton.Size = UDim2.new(0, 230, 0, 30)
AnimButton.Position = UDim2.new(0, 15, 0, 118)
AnimButton.Text = "Копировать анимации"
AnimButton.TextScaled = true
AnimButton.BackgroundColor3 = Color3.fromRGB(60,60,60)
AnimButton.TextColor3 = Color3.fromRGB(255,255,255)
AnimButton.Parent = Frame

-- Функция для точного копирования положения аксессуара
local function copyAccessoryPosition(originalAccessory, clonedAccessory, targetChar, myChar)
    local originalHandle = originalAccessory:FindFirstChild("Handle")
    local clonedHandle = clonedAccessory:FindFirstChild("Handle")
    local originalHead = targetChar:FindFirstChild("Head")
    local myHead = myChar:FindFirstChild("Head")
    
    if not originalHandle or not clonedHandle or not originalHead or not myHead then
        return
    end
    
    -- Находим оригинальный weld (крепление)
    local originalWeld
    for _, child in ipairs(originalHandle:GetChildren()) do
        if child:IsA("Weld") or child:IsA("Motor6D") then
            if child.Part0 == originalHead then
                originalWeld = child
                break
            end
        end
    end
    
    -- Очищаем старые крепления у клона
    for _, weld in ipairs(clonedHandle:GetChildren()) do
        if weld:IsA("Weld") or weld:IsA("Motor6D") then
            weld:Destroy()
        end
    end
    
    if originalWeld then
        -- Точное копирование оригинального крепления
        local newWeld = originalWeld:Clone()
        newWeld.Part0 = myHead
        newWeld.Part1 = clonedHandle
        newWeld.Parent = clonedHandle
    else
        -- Если нет weld, создаем его на основе относительного положения
        local relativePosition = originalHandle.Position - originalHead.Position
        local relativeCFrame = originalHead.CFrame:ToObjectSpace(originalHandle.CFrame)
        
        local weld = Instance.new("Weld")
        weld.Name = "HeadWeld"
        weld.Part0 = myHead
        weld.Part1 = clonedHandle
        weld.C0 = relativeCFrame
        weld.Parent = clonedHandle
    end
end

-- Функция для копирования цвета тела (ВСЕХ частей включая голову)
local function copyBodyColor(targetChar, myChar)
    -- Список всех частей тела для копирования цвета
    local bodyParts = {"Head", "Torso", "LeftArm", "RightArm", "LeftLeg", "RightLeg"}
    
    for _, partName in ipairs(bodyParts) do
        local targetPart = targetChar:FindFirstChild(partName)
        local myPart = myChar:FindFirstChild(partName)
        
        if targetPart and myPart then
            -- Копируем цвет тела (включая цвет кожи)
            myPart.BrickColor = targetPart.BrickColor
            myPart.Color = targetPart.Color
            
            -- Копируем материал и другие свойства
            myPart.Material = targetPart.Material
            myPart.Transparency = targetPart.Transparency
            myPart.Reflectance = targetPart.Reflectance
            
            -- Копируем текстуры поверхности
            for _, surface in ipairs(Enum.NormalId:GetEnumItems()) do
                local targetTexture = targetPart:FindFirstChild(surface.Name .. "Surface")
                local myTexture = myPart:FindFirstChild(surface.Name .. "Surface")
                
                if targetTexture then
                    if myTexture then
                        myTexture:Destroy()
                    end
                    local newTexture = targetTexture:Clone()
                    newTexture.Parent = myPart
                elseif myTexture then
                    myTexture:Destroy()
                end
            end
        end
    end
end

-- Функция для копирования головы (только меша и лица, без цвета)
local function copyHead(targetChar, myChar)
    local targetHead = targetChar:FindFirstChild("Head")
    local myHead = myChar:FindFirstChild("Head")
    
    if not targetHead or not myHead then return end
    
    -- Копируем меш головы
    local targetMesh = targetHead:FindFirstChildOfClass("SpecialMesh")
    if targetMesh then
        -- Удаляем старый меш
        for _, mesh in ipairs(myHead:GetChildren()) do
            if mesh:IsA("SpecialMesh") then
                mesh:Destroy()
            end
        end
        -- Копируем новый меш
        local newMesh = targetMesh:Clone()
        newMesh.Parent = myHead
    end
    
    -- Копируем лицо (только текстуру, не цвет)
    local face = targetHead:FindFirstChildOfClass("Decal")
    if face then
        -- Удаляем старое лицо
        for _, decal in ipairs(myHead:GetChildren()) do
            if decal:IsA("Decal") then
                decal:Destroy()
            end
        end
        -- Копируем новое лицо
        local newFace = face:Clone()
        newFace.Parent = myHead
    end
end

-- Функция для копирования одежды
local function copyClothing(targetChar, myChar)
    -- Удаляем старую одежду
    for _, item in ipairs(myChar:GetChildren()) do
        if item:IsA("Shirt") or item:IsA("Pants") or item:IsA("ShirtGraphic") then
            item:Destroy()
        end
    end
    
    -- Копируем новую одежду
    for _, item in ipairs(targetChar:GetChildren()) do
        if item:IsA("Shirt") or item:IsA("Pants") or item:IsA("ShirtGraphic") then
            local clone = item:Clone()
            clone.Parent = myChar
        end
    end
end

-- Функция для копирования волос и аксессуаров
local function copyAccessories(targetChar, myChar)
    -- Удаляем старые аксессуары
    for _, item in ipairs(myChar:GetChildren()) do
        if item:IsA("Accessory") or item:IsA("Hat") then
            item:Destroy()
        end
    end
    
    -- Копируем новые аксессуары
    for _, originalAccessory in ipairs(targetChar:GetChildren()) do
        if (originalAccessory:IsA("Accessory") or originalAccessory:IsA("Hat")) and originalAccessory:FindFirstChild("Handle") then
            local clone = originalAccessory:Clone()
            clone.Parent = myChar
            copyAccessoryPosition(originalAccessory, clone, targetChar, myChar)
        end
    end
end

-- Функция для копирования частей тела (рук, ног и т.д.)
local function copyBodyParts(targetChar, myChar)
    local bodyParts = {"LeftArm", "RightArm", "LeftLeg", "RightLeg", "Torso", "Head"}
    
    for _, partName in ipairs(bodyParts) do
        local targetPart = targetChar:FindFirstChild(partName)
        local myPart = myChar:FindFirstChild(partName)
        
        if targetPart and myPart then
            -- Копируем размер и форму
            myPart.Size = targetPart.Size
            
            -- Копируем все декоративные элементы
            for _, child in ipairs(targetPart:GetChildren()) do
                if child:IsA("Decal") or child:IsA("SpecialMesh") or child:IsA("Texture") then
                    -- Удаляем старые аналогичные элементы
                    for _, myChild in ipairs(myPart:GetChildren()) do
                        if myChild.ClassName == child.ClassName and myChild.Name == child.Name then
                            myChild:Destroy()
                        end
                    end
                    
                    -- Копируем новый элемент
                    local clone = child:Clone()
                    clone.Parent = myPart
                end
            end
        end
    end
end

-- Функция для копирования анимаций из каталога Roblox
local function copyRobloxAnimations(targetChar, myChar)
    local targetHumanoid = targetChar:FindFirstChildOfClass("Humanoid")
    local myHumanoid = myChar:FindFirstChildOfClass("Humanoid")
    
    if not targetHumanoid or not myHumanoid then return end
    
    -- Получаем Animator
    local targetAnimator = targetHumanoid:FindFirstChildOfClass("Animator")
    local myAnimator = myHumanoid:FindFirstChildOfClass("Animator")
    
    if not myAnimator then
        myAnimator = Instance.new("Animator")
        myAnimator.Parent = myHumanoid
    end
    
    -- Очищаем старые анимации
    for _, track in ipairs(myAnimator:GetPlayingAnimationTracks()) do
        track:Stop()
    end
    
    -- Ищем скрипт Animate у целевого игрока
    local targetAnimate = targetChar:FindFirstChild("Animate")
    if targetAnimate then
        -- Удаляем наш старый скрипт Animate
        local myAnimate = myChar:FindFirstChild("Animate")
        if myAnimate then
            myAnimate:Destroy()
        end
        
        -- Копируем скрипт Animate
        local newAnimate = targetAnimate:Clone()
        newAnimate.Parent = myChar
        
        -- Ждем немного для применения анимаций
        task.wait(0.5)
        return true
    end
    
    -- Если скрипта Animate нет, ищем анимации в Humanoid
    local animationTypes = {
        "Walk",
        "Run", 
        "Jump",
        "Idle",
        "Fall",
        "Swim",
        "Climb"
    }
    
    for _, animType in ipairs(animationTypes) do
        local targetAnim = targetHumanoid:FindFirstChild(animType .. "Animation")
        if targetAnim and targetAnim:IsA("Animation") then
            -- Удаляем нашу старую анимацию
            local myAnim = myHumanoid:FindFirstChild(animType .. "Animation")
            if myAnim then
                myAnim:Destroy()
            end
            
            -- Копируем новую анимацию
            local newAnim = targetAnim:Clone()
            newAnim.Parent = myHumanoid
        end
    end
    
    -- Копируем скорости движения
    myHumanoid.WalkSpeed = targetHumanoid.WalkSpeed
    myHumanoid.JumpPower = targetHumanoid.JumpPower
    
    return true
end

-- Функция смены внешности
local function ChangeAppearance(targetPlayer)
    if not targetPlayer.Character or not LocalPlayer.Character then return end

    local char = LocalPlayer.Character
    local targetChar = targetPlayer.Character

    -- Ждем немного чтобы персонаж обновился
    task.wait(0.1)

    -- Сначала копируем цвет тела (ВКЛЮЧАЯ голову и цвет кожи)
    copyBodyColor(targetChar, char)
    
    -- Копируем части тела (руки, ноги, торс)
    copyBodyParts(targetChar, char)
    
    -- Затем копируем голову (только меш и лицо, без цвета)
    copyHead(targetChar, char)
    
    -- Копируем одежду
    copyClothing(targetChar, char)
    
    -- Копируем волосы и аксессуары
    copyAccessories(targetChar, char)
    
    -- Копируем масштаб тела для лучшего соответствия
    local targetHumanoid = targetChar:FindFirstChildOfClass("Humanoid")
    local myHumanoid = char:FindFirstChildOfClass("Humanoid")
    
    if targetHumanoid and myHumanoid then
        myHumanoid.BodyTypeScale = targetHumanoid.BodyTypeScale
        myHumanoid.HeadScale = targetHumanoid.HeadScale
        myHumanoid.BodyDepthScale = targetHumanoid.BodyDepthScale
        myHumanoid.BodyHeightScale = targetHumanoid.BodyHeightScale
        myHumanoid.BodyWidthScale = targetHumanoid.BodyWidthScale
        
        -- Копируем позу
        myHumanoid.Sit = targetHumanoid.Sit
    end
end

-- Кнопка смены внешности
Button.MouseButton1Click:Connect(function()
    local name = TextBox.Text
    local target = Players:FindFirstChild(name)
    if target then
        ChangeAppearance(target)
        Button.Text = "Внешность скопирована!"
        task.wait(1.5)
        Button.Text = "Сменить внешность"
    else
        Button.Text = "Игрок не найден!"
        task.wait(1.5)
        Button.Text = "Сменить внешность"
    end
end)

-- Кнопка копирования анимаций
AnimButton.MouseButton1Click:Connect(function()
    local name = TextBox.Text
    local target = Players:FindFirstChild(name)
    if target and target.Character and LocalPlayer.Character then
        local success = copyRobloxAnimations(target.Character, LocalPlayer.Character)
        if success then
            AnimButton.Text = "Анимации скопированы!"
        else
            AnimButton.Text = "Ошибка копирования!"
        end
        task.wait(1.5)
        AnimButton.Text = "Копировать анимации"
    else
        AnimButton.Text = "Игрок не найден!"
        task.wait(1.5)
        AnimButton.Text = "Копировать анимации"
    end
end)
